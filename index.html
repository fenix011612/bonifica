<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Bonifica√ß√£o de Colaboradores</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6ff;
  padding:20px;
}
.container{
  max-width:1100px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
}
h2{
  color:#6a5acd;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  border:1px solid #ddd;
  padding:8px;
  text-align:center;
}
th{
  background:#6a5acd;
  color:#fff;
}
input,select{
  padding:6px;
  margin:5px;
}
.btn{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  color:#fff;
}
.b50{background:#e74c3c}
.b75{background:#f1c40f;color:#000}
.b100{background:#2ecc71}
.save{background:#6a5acd}
.delete{background:#e74c3c}
</style>
</head>

<body>
<div class="container">

<h2>Avalia√ß√£o de Desempenho ‚Äì Bonifica√ß√£o</h2>

<input id="nome" placeholder="Nome do colaborador">
<input id="salario" type="number" placeholder="M√©dia salarial (R$)">
<select id="semestre">
  <option>Janeiro a Junho</option>
  <option>Julho a Dezembro</option>
</select>

<table>
<thead>
<tr>
<th>Crit√©rio</th>
<th>Pontua√ß√£o</th>
</tr>
</thead>
<tbody id="criterios"></tbody>
</table>

<br>
<button class="btn save" onclick="salvar()">Salvar Avalia√ß√£o</button>
<button class="btn delete" onclick="apagarTudo()">Apagar Hist√≥rico</button>

<hr>

<h2>üèÜ Ranking</h2>

<table>
<thead>
<tr>
<th>Pos</th>
<th>Nome</th>
<th>Semestre</th>
<th>M√©dia</th>
<th>B√¥nus</th>
<th>Valor (R$)</th>
<th>A√ß√µes</th>
</tr>
</thead>
<tbody id="ranking"></tbody>
</table>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  getDocs,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyCsuGHuKu99EONQY8HLAnYkFSKIpsg-5qk",
  authDomain: "bonifica-45f34.firebaseapp.com",
  projectId: "bonifica-45f34",
  storageBucket: "bonifica-45f34.firebasestorage.app",
  messagingSenderId: "504662283087",
  appId: "1:504662283087:web:9027f63fc7e3603735ab3a"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* CRIT√âRIOS */
const criterios = [
 "Meta Financeira",
 "Meta Qualidade",
 "Meta Planejamento",
 "Meta Produtividade",
 "Qualidade do Trabalho",
 "Produtividade",
 "Trabalho em Equipe",
 "Criatividade",
 "Alinhamento, Cultura e Valores",
 "Assiduidade e Pontualidade"
];

let pontos = Array(criterios.length).fill(0);
const tbody = document.getElementById("criterios");

criterios.forEach((c,i)=>{
  tbody.innerHTML += `
  <tr>
    <td>${c}</td>
    <td>
      <button class="btn b50" onclick="pontuar(${i},50)">50%</button>
      <button class="btn b75" onclick="pontuar(${i},75)">75%</button>
      <button class="btn b100" onclick="pontuar(${i},100)">100%</button>
      <strong id="p${i}">0%</strong>
    </td>
  </tr>`;
});

window.pontuar = (i,v)=>{
  pontos[i] = v;
  document.getElementById("p"+i).innerText = v + "%";
};

/* SALVAR AVALIA√á√ÉO */
window.salvar = async ()=>{
  const nome = document.getElementById("nome").value.trim();
  const semestre = document.getElementById("semestre").value;
  const salario = parseFloat(document.getElementById("salario").value);

  if(!nome || !salario){
    alert("Preencha nome e m√©dia salarial");
    return;
  }

  const media = pontos.reduce((a,b)=>a+b,0) / pontos.length;

  let bonusTexto = "Sem b√¥nus";
  let bonusValor = 0;

  if(media >= 100){
    bonusTexto = "¬Ω sal√°rio";
    bonusValor = salario * 0.5;
  }else if(media >= 75){
    bonusTexto = "‚Öì sal√°rio";
    bonusValor = salario * 0.33;
  }else if(media >= 50){
    bonusTexto = "¬º sal√°rio";
    bonusValor = salario * 0.25;
  }

  await addDoc(collection(db,"avaliacoes"),{
    nome,
    semestre,
    salario,
    media,
    bonusTexto,
    bonusValor,
    criadoEm: new Date()
  });

  carregarRanking();
};

/* RANKING */
async function carregarRanking(){
  const snap = await getDocs(collection(db,"avaliacoes"));
  const dados = [];
  snap.forEach(d=>dados.push({id:d.id,...d.data()}));

  dados.sort((a,b)=>b.media - a.media);

  const rank = document.getElementById("ranking");
  rank.innerHTML = "";

  dados.forEach((d,i)=>{
    rank.innerHTML += `
    <tr>
      <td>${i+1}</td>
      <td>${d.nome}</td>
      <td>${d.semestre}</td>
      <td>${d.media.toFixed(1)}%</td>
      <td>${d.bonusTexto}</td>
      <td>R$ ${d.bonusValor.toFixed(2)}</td>
      <td>
        <button class="btn delete" onclick="excluir('${d.id}')">Excluir</button>
      </td>
    </tr>`;
  });
}

window.excluir = async (id)=>{
  await deleteDoc(doc(db,"avaliacoes",id));
  carregarRanking();
};

window.apagarTudo = async ()=>{
  const snap = await getDocs(collection(db,"avaliacoes"));
  snap.forEach(async d=>{
    await deleteDoc(doc(db,"avaliacoes",d.id));
  });
  carregarRanking();
};

carregarRanking();
</script>

</body>
</html>
